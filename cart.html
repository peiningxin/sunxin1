<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>春播-购物车页</title>
    <link rel="stylesheet" href="css/cart.css">
</head>
<body>
    <!-- 头部 -->
    <div class="header">
        <div class="header_top">
            <div class="header_inner">
                <a href="index.html" class="logo"></a>
                <div class="header_login">
                    欢迎
                    <!-- <a href="javascript:;" class="header_user">176*****3...</a> -->
                    <a href="javascript:;" class="login">登录/注册</a>
                    <span class="username_show"></span>
                    <a href="javascript:;" class="signOut">[退出]</a>
                </div>
            </div>
        </div>
    </div>
    <!-- 内容 -->
    <div class="section_one box">
        <div class="title">购物车
            <a href="javascript:;">全场满158元免运费</a>
        </div>
        <table>
            <thead>
                <tr>
                    <th colspan="3">商品信息</th>
                    <th>单价</th>
                    <th>数量</th>
                    <th>总价</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="ulbox">
                <!-- <tr>
                    <td class="td1">
                        <a href="javascript:;" class="check_box"></a>
                    </td>
                    <td class="td2">
                        <a href="javascript:;"><img src="images/shopping1.jpg" alt=""></a>
                    </td>
                    <td class="td3">
                        <h4>安心优选海南小青桔250g</h4>
                    </td>
                    <td class="td4">
                        <span>¥ 9.90</span>
                    </td>
                    <td class="td5">
                        <div class="num_box">
                            <span>1</span>
                            <a href="javascript:;" class="plus_btn"><i></i></a>
                            <a href="javascript:;" class="reduce_btn"><i></i></a>
                        </div>
                    </td>
                    <td class="td6">
                        <span>￥9.90</span>
                    </td>
                    <td class="td7">
                        <span class="del_box"></span>
                        <a href="javascript:;">移动心愿单</a>
                    </td>
                </tr>
                <tr>
                    <td class="td1">
                        <a href="javascript:;" class="check_box"></a>
                    </td>
                    <td class="td2">
                        <a href="javascript:;"><img src="images/shopping1.jpg" alt=""></a>
                    </td>
                    <td class="td3">
                        <h4>安心优选海南小青桔250g</h4>
                    </td>
                    <td class="td4">
                        <span>¥ 9.90</span>
                    </td>
                    <td class="td5">
                        <div class="num_box">
                            <span>1</span>
                            <a href="javascript:;" class="plus_btn"><i></i></a>
                            <a href="javascript:;" class="reduce_btn"><i></i></a>
                        </div>
                    </td>
                    <td class="td6">
                        <span>￥9.90</span>
                    </td>
                    <td class="td7">
                        <span class="del_box"></span>
                        <a href="javascript:;">移动心愿单</a>
                    </td>
                </tr>
                <tr>
                    <td class="td1">
                        <a href="javascript:;" class="check_box"></a>
                    </td>
                    <td class="td2">
                        <a href="javascript:;"><img src="images/shopping1.jpg" alt=""></a>
                    </td>
                    <td class="td3">
                        <h4>安心优选海南小青桔250g</h4>
                    </td>
                    <td class="td4">
                        <span>¥ 9.90</span>
                    </td>
                    <td class="td5">
                        <div class="num_box">
                            <span>1</span>
                            <a href="javascript:;" class="plus_btn"><i></i></a>
                            <a href="javascript:;" class="reduce_btn"><i></i></a>
                        </div>
                    </td>
                    <td class="td6">
                        <span>￥9.90</span>
                    </td>
                    <td class="td7">
                        <span class="del_box"></span>
                        <a href="javascript:;">移动心愿单</a>
                    </td>
                </tr>
                <tr>
                    <td class="td1">
                        <a href="javascript:;" class="check_box"></a>
                    </td>
                    <td class="td2">
                        <a href="javascript:;"><img src="images/shopping1.jpg" alt=""></a>
                    </td>
                    <td class="td3">
                        <h4>安心优选海南小青桔250g</h4>
                    </td>
                    <td class="td4">
                        <span>¥ 9.90</span>
                    </td>
                    <td class="td5">
                        <div class="num_box">
                            <span>1</span>
                            <a href="javascript:;" class="plus_btn"><i></i></a>
                            <a href="javascript:;" class="reduce_btn"><i></i></a>
                        </div>
                    </td>
                    <td class="td6">
                        <span>￥9.90</span>
                    </td>
                    <td class="td7">
                        <span class="del_box"></span>
                        <a href="javascript:;" >移动心愿单</a>
                    </td>
                </tr> -->
            </tbody>
        </table>
        <div class="cart-tip">
            春播已为您所购的全部商品进行了<b>安心检测</b>，您可以通过订单及短信等<b>查询检测报告</b>。春播为您和家人的健康保驾护航。
        </div>
        <div class="cart_box_bottom">
            <div class="left">
                <a href="javascript:;" class="all_sel">全选
                    <span class="checkedAll"></span>
                </a>
                <div class="all_del">删除</div>
                <div class="add_fav">移入心愿单</div>
                <fav></fav>
            </div>
            
            <div class="right">
                商品总价（不含运费和优惠扣减）
                <strong class="allPrice">￥0.00</strong>
                <a href="javascript:;" class="buy_btn">去结算</a>
            </div>
        </div>
    </div>
    <div class="section_two">
        <div class="left">
            <span>请重复用使用</span>
            订单送到办公室？<br>
            您或许需要一个购物袋
        </div>
        <div class="center">
            <a href="javascript:;" class="img"><img src="images/shoppingBag.jpg" alt=""></a>
            <h4>春播购物袋</h4>
            <p>尺寸：40cm × 40cm</p>
            <p>单价：¥2.00</p>
        </div>
        <a href="javascript:;" class="right">加入购物车</a>
    </div>
    <div class="section_three">
        <div class="title">热销商品</div>
        <div class="content">
            <div class="menu">
                <a href="javascript:;" class="food_pic"><img src="images/mht1.jpg" alt=""></a>
                <p class="food_msg">阳光般的金黄色果肉</p>
                <a href="javascript:;" class="food_name">佳沛新西兰巨无霸金奇异果</a>
                <strong class="food_price">￥88.00</strong>
                <b class="food_num">8个</b>
                <div class="fav">
                    <i></i>
                    <span>添加到心愿单</span>
                </div>
                <a href="javascript:;" class="add_shop">加入购物车</a>
            </div>
            <div class="menu">
                <a href="javascript:;" class="food_pic"><img src="images/mht1.jpg" alt=""></a>
                <p class="food_msg">阳光般的金黄色果肉</p>
                <a href="javascript:;" class="food_name">佳沛新西兰巨无霸金奇异果</a>
                <strong class="food_price">￥88.00</strong>
                <b class="food_num">8个</b>
                <div class="fav">
                    <i></i>
                    <span>添加到心愿单</span>
                </div>
                <a href="javascript:;" class="add_shop">加入购物车</a>
            </div>
            <div class="menu">
                <a href="javascript:;" class="food_pic"><img src="images/mht1.jpg" alt=""></a>
                <p class="food_msg">阳光般的金黄色果肉</p>
                <a href="javascript:;" class="food_name">佳沛新西兰巨无霸金奇异果</a>
                <strong class="food_price">￥88.00</strong>
                <b class="food_num">8个</b>
                <div class="fav">
                    <i></i>
                    <span>添加到心愿单</span>
                </div>
                <a href="javascript:;" class="add_shop">加入购物车</a>
            </div>
            <div class="menu">
                <a href="javascript:;" class="food_pic"><img src="images/mht1.jpg" alt=""></a>
                <p class="food_msg">阳光般的金黄色果肉</p>
                <a href="javascript:;" class="food_name">佳沛新西兰巨无霸金奇异果</a>
                <strong class="food_price">￥88.00</strong>
                <b class="food_num">8个</b>
                <div class="fav">
                    <i></i>
                    <span>添加到心愿单</span>
                </div>
                <a href="javascript:;" class="add_shop">加入购物车</a>
            </div>
            <div class="menu">
                <a href="javascript:;" class="food_pic"><img src="images/mht1.jpg" alt=""></a>
                <p class="food_msg">阳光般的金黄色果肉</p>
                <a href="javascript:;" class="food_name">佳沛新西兰巨无霸金奇异果</a>
                <strong class="food_price">￥88.00</strong>
                <b class="food_num">8个</b>
                <div class="fav">
                    <i></i>
                    <span>添加到心愿单</span>
                </div>
                <a href="javascript:;" class="add_shop">加入购物车</a>
            </div>
        </div>
    </div>    
    <!-- 页脚 -->
    <div class="footer">
        <div class="footer_inner">
            <div class="bot">
                <span>©2016 北京春播科技有限公司版权所有，并保留所有权利。</span>
                <p>
                    <a href="javascript:;" target="_blank">京ICP备14048334号</a>
                    &nbsp; 京公网安备11010802016828号&nbsp; 食品经营许可证JY11128071189894
                </p>
            </div>
        </div>
    </div>


    
    <script src="js/jquery-1.8.3.js"></script>  
    <script src="js/cookieUtil.js"></script>  
    <script src="js/cart.js?a=1"></script>


<script type="text/javascript">
    var username = getCookie("username");
    if(username!=""){
        $(function () {
            $.ajax({
                type:"get",
                url:"getShoppingCart.php",
                data:{"vipName":username},
                success:function (data) {
                    showgoodscart(data);
                    //价钱计算函数
                    function Calculate(){
                        var s=0;
                        
                        $('.sprice').each(function(k,v){
                            if(!$('.check_box').eq(k).hasClass('active')){
                                var everyPrice = $('.sprice').eq(k).text().substring(1)*$('.goodsNum').eq(k).html();
                                $('.everyPrice').eq(k).html('￥'+everyPrice);
                                s=s+everyPrice;
                            }
                        });
                        $('.allPrice').html("￥"+s);
                    }
                    Calculate();
                    //单选
                    $('.check_box').bind('click',function(){
                        $(this).toggleClass('active');
                        if($('.check_box').hasClass('active')){
                            $('.checkedAll').addClass('active'); 
                        }else{
                            $('.checkedAll').removeClass('active'); 
                        }
                        Calculate();
                    })
                    //全选
                    $('.checkedAll').bind('click',function(){
                        $(this).toggleClass('active');
                        if($('.checkedAll').hasClass('active')){
                            $('tbody .check_box').addClass('active');
                        }else{
                            $('tbody .check_box').removeClass('active'); 
                        }
                        Calculate();
                    })

                    //商品数量加
                    $('.plus_btn').click(function(){
                        var curNum = $(this).siblings('span').html();
                        curNum++;
                        $(this).siblings('span').html(curNum);
                        var goodsId=$(this).parent().parent().siblings('.td3').children('h4').attr('goodsId');
                        Calculate();
                        $(function () {
                            $.ajax({
                                type:"get",
                                url:"updateGoodsCount.php",
                                data:{"vipName":username,"goodsId":goodsId,"goodsCount":curNum},
                                success:function (data) {
                                    if(data===1){
                                        alert('修改成功');
                                    }
                                    if(data===0){
                                        alert('修改失败');
                                    }
                                },
                                dataType:"json"
                            });
                        });

                    })
                    //商品数量减
                    $('.reduce_btn').click(function(){
                        var curNum = $(this).siblings('span').html();
                        if(curNum>1){
                            curNum--;
                            $(this).siblings('span').html(curNum);
                        }
                        var goodsId=$(this).parent().parent().siblings('.td3').children('h4').attr('goodsId');
                        Calculate();
                        $(function () {
                            $.ajax({
                                type:"get",
                                url:"updateGoodsCount.php",
                                data:{"vipName":username,"goodsId":goodsId,"goodsCount":curNum},
                                success:function (data) {
                                    if(data===1){
                                        alert('修改成功');
                                    }
                                    if(data===0){
                                        alert('修改失败');
                                    }
                                },
                                dataType:"json"
                            });
                        });
                    })

                    
                    //删除商品
                    $('.del_box').click(function(){
                        $(this).parent().parent().remove();  //删除页面的商品
                        Calculate();
                        var goodsId=$(this).parent().siblings('.td3').children('h4').attr('goodsId');
                        $(function () {
                            $.ajax({
                                type:"get",
                                url:"deleteGoods.php",
                                data:{"vipName":username,"goodsId":goodsId},
                                success:function (data) {
                                    if(data===1){
                                        alert('删除成功');
                                    }
                                    if(data===0){
                                        alert('删除失败');
                                    }
                                },
                                dataType:"json"
                            });
                        });
                    })


                },
                dataType:"json"
            });
        });
    }else{
        alert("亲，请先在首页登录!");
    }
    
    function showgoodscart(datas) {
        let $ulbox = $("#ulbox");
        for(let i=0;i<datas.length;i++){
            let str = `<tr>
                    <td class="td1">
                        <a href="javascript:;" class="check_box"></a>
                    </td>
                    <td class="td2">
                        <a href="javascript:;"><img src="${datas[i].goodsImg}" alt=""></a>
                    </td>
                    <td class="td3">
                        <h4 goodsId="${datas[i].goodsId}">${datas[i].goodsName}</h4>
                    </td>
                    <td class="td4">
                        <span class="sprice">¥ ${datas[i].goodsPrice}</span>
                    </td>
                    <td class="td5">
                        <div class="num_box">
                            <span class="goodsNum">${datas[i].goodsCount}</span>
                            <a href="javascript:;" class="plus_btn"><i></i></a>
                            <a href="javascript:;" class="reduce_btn"><i></i></a>
                        </div>
                    </td>
                    <td class="td6">
                        <span class="everyPrice">￥9.90</span>
                    </td>
                    <td class="td7">
                        <span class="del_box"></span>
                        <a href="javascript:;">移动心愿单</a>
                    </td>
                </tr>`;
            $ulbox.append(str);
        }
    }
</script> 

</body>
</html>